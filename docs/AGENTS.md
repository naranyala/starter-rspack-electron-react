# AI Agent Guide

This document is a fast, pragmatic guide for agents making changes to this repo. It focuses on where things live, which files are source of truth, and how to avoid common pitfalls.

## Quick Orientation

- The app is an Electron desktop app with a React renderer bundled by Rspack.
- The main process entry is `main.ts`, compiled to `main.cjs` for runtime.
- The preload entry used at runtime is `preload.ts`, compiled to `preload.js`.
- The renderer entry is `src/index.tsx` and UI lives in `src/renderer/` and `src/App.tsx`.
- Scripts are TypeScript in `scripts/*.ts`, but package scripts execute the compiled `scripts/*.js`.

## Source Of Truth

- Edit TypeScript sources first.
- Keep runtime entrypoints in sync:
- `main.cjs` should match `main.ts`.
- `preload.js` should match `preload.ts`.
- `scripts/*.js` should match `scripts/*.ts`.
- Running `bun run tsc` will rebuild outputs into `dist-ts/`, and the `postbuild` step copies key artifacts into place.

## Do Not Edit (Unless You Are Regenerating)

- `dist/` and `dist-ts/` are build outputs.
- `src/main/handlers/*.js` and `src/main/handlers/*.js.map` are generated by `postbuild` and can be overwritten.

## Key Commands

- `bun install` to install dependencies.
- `bun run dev` for local dev (uses `scripts/dev-runner.js`).
- `bun run build` to build renderer assets (Rspack) and copy main/preload artifacts.
- `bun run dist` to package with electron-builder.
- `bun run tsc` to compile TypeScript to `dist-ts/`.

## Project Workflow Notes

- `scripts/dev-runner.js` spins up the Rspack dev server, writes `.dev-port.json`, and launches Electron using `main.cjs`.
- Dev server port is read from `DEV_SERVER_PORT` or `.dev-port.json` in both `main.ts` and `rspack.config.ts`.
- The preload bridge currently exposes a minimal `electronAPI` surface. Add new IPC methods there and in `src/main/handlers/*`.

## Common Edit Targets

- Main process: `main.ts`, `src/main/lib/**/*`, `src/main/handlers/**/*`.
- Preload bridge: `preload.ts` (runtime) and `src/main/preload.ts` (legacy/example).
- Renderer UI: `src/App.tsx`, `src/renderer/components/**/*`, `src/renderer/features/**/*`.
- Shared utilities: `src/shared/**/*` and `src/renderer/lib/**/*`.

## Gotchas

- There are two preload sources. Runtime uses `preload.ts` in the repo root. `src/main/preload.ts` is not referenced by `main.ts`.
- `scripts/*.js` are executed by `package.json`. If you change only `scripts/*.ts`, the runtime will not see it until JS is regenerated.
- The handlers are demo-style content providers; they register `ipcMain.handle` channels with static responses.
